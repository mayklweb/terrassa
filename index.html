<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style/main.css" />
    <title>Terrassa Khiva | Terrassa Restaurant & Cafe</title>
    <script src="https://cdn.jsdelivr.net/npm/panolens@0.12.0/build/panolens.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.min.js"></script>
  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <div class="container">
          <div class="header-row">
            <div class="header-logo"></div>
            <div class="header-action"></div>
          </div>
        </div>
      </header>
      <main class="main">
        <div id="progress"></div>
      </main>
      <footer class="footer"></footer>
    </div>
    <script src="./js/three/three.min.js"></script>
    <script src="./js/penolens/penolens.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r105/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/panolens@0.12.0/build/panolens.min.js"></script>

    <script>
      let panorama,
        panorama2,
        viewer,
        progress,
        progressElement,
        panorama3,
        panorama4,
        panorama5,
        panorama6,
        panorama7,
        panorama8,
        panorama9,
        panorama10,
        panorama11,
        panorama12,
        panorama13,
        panorama14,
        panorama15;

      progressElement = document.getElementById("progress");

      function onEnter(event) {
        progressElement.style.width = 0;
        progressElement.classList.remove("finish");
      }

      function onProgress(event) {
        progress = (event.progress.loaded / event.progress.total) * 100;
        progressElement.style.width = progress + "%";
        console.log();

        if (progress === 100) {
          progressElement.classList.add("finish");
        }
      }

      // First panorama
      panorama = new PANOLENS.ImagePanorama("media/15.webp");
      panorama.addEventListener("progress", onProgress);
      panorama.addEventListener("enter", onEnter);

      // Second panorama
      panorama2 = new PANOLENS.ImagePanorama("media/2.webp");
      panorama2.addEventListener("progress", onProgress);
      panorama2.addEventListener("enter", onEnter);

      panorama3 = new PANOLENS.ImagePanorama("media/3.webp");
      panorama3.addEventListener("progress", onProgress);
      panorama3.addEventListener("enter", onEnter);

      panorama4 = new PANOLENS.ImagePanorama("media/4.webp");
      panorama4.addEventListener("progress", onProgress);
      panorama4.addEventListener("enter", onEnter);

      panorama5 = new PANOLENS.ImagePanorama("media/5.webp");
      panorama5.addEventListener("progress", onProgress);
      panorama5.addEventListener("enter", onEnter);

      panorama6 = new PANOLENS.ImagePanorama("media/6.webp");
      panorama6.addEventListener("progress", onProgress);
      panorama6.addEventListener("enter", onEnter);

      panorama7 = new PANOLENS.ImagePanorama("media/7.webp");
      panorama7.addEventListener("progress", onProgress);
      panorama7.addEventListener("enter", onEnter);

      panorama8 = new PANOLENS.ImagePanorama("media/8.webp");
      panorama8.addEventListener("progress", onProgress);
      panorama8.addEventListener("enter", onEnter);

      panorama9 = new PANOLENS.ImagePanorama("media/9.webp");
      panorama9.addEventListener("progress", onProgress);
      panorama9.addEventListener("enter", onEnter);

      panorama10 = new PANOLENS.ImagePanorama("media/10.webp");
      panorama10.addEventListener("progress", onProgress);
      panorama10.addEventListener("enter", onEnter);

      panorama11 = new PANOLENS.ImagePanorama("media/11.webp");
      panorama11.addEventListener("progress", onProgress);
      panorama11.addEventListener("enter", onEnter);

      panorama12 = new PANOLENS.ImagePanorama("media/12.webp");
      panorama12.addEventListener("progress", onProgress);
      panorama12.addEventListener("enter", onEnter);

      panorama13 = new PANOLENS.ImagePanorama("media/13.webp");
      panorama13.addEventListener("progress", onProgress);
      panorama13.addEventListener("enter", onEnter);

      panorama14 = new PANOLENS.ImagePanorama("media/14.webp");
      panorama14.addEventListener("progress", onProgress);
      panorama14.addEventListener("enter", onEnter);

      panorama15 = new PANOLENS.ImagePanorama("media/15.webp");
      panorama15.addEventListener("progress", onProgress);
      panorama15.addEventListener("enter", onEnter);

      // Linking panoramas
      // panorama.link(panorama2, new THREE.Vector3(4000, 160, 360));

      panorama2.link(panorama3, new THREE.Vector3(-300, 800, -3800));

      panorama3.link(panorama4, new THREE.Vector3(-2500, 400, 1400));
      panorama3.link(panorama2, new THREE.Vector3(-2400, -1000, 300));

      panorama4.link(panorama5, new THREE.Vector3(-2000, -200, 1100));
      panorama4.link(panorama8, new THREE.Vector3(550, -200, 1800));
      panorama4.link(panorama3, new THREE.Vector3(0, -1400, -2200));
      panorama4.link(panorama10, new THREE.Vector3(-800, 550, -2400));

      panorama5.link(panorama6, new THREE.Vector3(1100, 0, -2600));
      panorama5.link(panorama4, new THREE.Vector3(-3000, 0, 1000));

      panorama6.link(panorama7, new THREE.Vector3(2400, 100, -800));
      panorama6.link(panorama5, new THREE.Vector3(-2600, 0, 600));

      panorama7.link(panorama6, new THREE.Vector3(-1400, 0, 100));

      panorama8.link(panorama9, new THREE.Vector3(-3000, -100, 500));
      panorama8.link(panorama4, new THREE.Vector3(2200, 0, -400));

      panorama9.link(panorama8, new THREE.Vector3(-3000, -100, 200));

      panorama10.link(panorama4, new THREE.Vector3(-2400, -800, 900));
      panorama10.link(panorama11, new THREE.Vector3(-2200, 800, 1800));

      panorama11.link(panorama10, new THREE.Vector3(50, -800, -1800));
      panorama11.link(panorama12, new THREE.Vector3(-2200, -100, 0));
      panorama11.link(panorama14, new THREE.Vector3(-600, -100, 2200));

      panorama12.link(panorama13, new THREE.Vector3(2400, -100, -400));
      panorama12.link(panorama11, new THREE.Vector3(-400, -100, -2200));

      panorama13.link(panorama12, new THREE.Vector3(-1100, -100, -1800));
      panorama13.link(panorama14, new THREE.Vector3(1800, -100, 600));

      panorama14.link(panorama11, new THREE.Vector3(500, -100, -1800));
      panorama14.link(panorama13, new THREE.Vector3(-1400, -100, -700));
      panorama14.link(panorama15, new THREE.Vector3(100, -100, 1800));

      
      panorama.link(panorama14, new THREE.Vector3(-1900, -100, 600));








      viewer = new PANOLENS.Viewer();
      viewer.add(
        panorama,
        panorama2,
        panorama3,
        panorama4,
        panorama5,
        panorama6,
        panorama7,
        panorama8,
        panorama9,
        panorama10,
        panorama11,
        panorama12,
        panorama13,
        panorama14,
        panorama15
      );
    </script>

    <!-- <script type="module">
      const viewer = new PANOLENS.Viewer();
      let panorama1 = new PANOLENS.ImagePanorama("media/1.webp");
      let panorama2 = new PANOLENS.ImagePanorama("media/2.webp");

      viewer.add(panorama1);
      viewer.add(panorama2);

      function transitionPanorama(newPanorama) {
        let fov = { value: viewer.camera.fov }; // Hozirgi FOV
        let opacity = { value: 1 };

        // Zoom-in effekti
        new TWEEN.Tween(fov)
          .to({ value: 30 }, 800) // Kichik fov -> Zoom-in
          .onUpdate(() => {
            viewer.camera.fov = fov.value;
            viewer.camera.updateProjectionMatrix();
          })
          .start();

        // Fade-out effekti
        new TWEEN.Tween(opacity)
          .to({ value: 0.5 }, 800)
          .onUpdate(() => {
            viewer.panorama.material.opacity = opacity.value;
          })
          .onComplete(() => {
            viewer.setPanorama(newPanorama);

            // Fade-in va Zoom-out (normal holatga qaytish)
            new TWEEN.Tween(opacity)
              .to({ value: 1 }, 800)
              .onUpdate(() => {
                viewer.panorama.material.opacity = opacity.value;
              })
              .start();

            new TWEEN.Tween(fov)
              .to({ value: 70 }, 800) // Katta fov -> Zoom-out
              .onUpdate(() => {
                viewer.camera.fov = fov.value;
                viewer.camera.updateProjectionMatrix();
              })
              .start();
          })
          .start();
      }

      // Har safar bosilganda rasm oâ€˜zgarishi va effekt bajarilishi
      document.addEventListener("click", function () {
        transitionPanorama(
          viewer.panorama === panorama1 ? panorama2 : panorama1
        );
      });

      // Animate qilish kerak
      function animate() {
        requestAnimationFrame(animate);
        TWEEN.update();
      }
      animate();
    </script> -->
  </body>
</html>
